<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lesson 9: ggplot part 2</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Collaborative and Reproducible Data Science in R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture notes</li>
    <li>
      <a href="lesson1-rstudio.html">Lesson 1: R Studio</a>
    </li>
    <li>
      <a href="lesson2-rmarkdown-github.html">Lesson 2: RMarkdown and GitHub</a>
    </li>
    <li>
      <a href="lesson3-version-control.html">Lesson 3: Version control and the Git/GitHub workflow</a>
    </li>
    <li>
      <a href="lesson4-collaboration.html">Lesson 4: Collaborating with GitHub - Part 1</a>
    </li>
    <li>
      <a href="lesson5-collaboration-part2.html">Lesson 5: Collaborating with GitHub - Part 2</a>
    </li>
    <li>
      <a href="lesson6-ggplot-part1.html">Lesson 6: Plotting with ggplot - Part 1</a>
    </li>
    <li>
      <a href="lesson7-data-wrangling1.html">Lesson 7: Data wrangling - Part 1</a>
    </li>
    <li>
      <a href="lesson8-data-wrangling2.html">Lesson 8: Data wrangling - Part 2</a>
    </li>
    <li>
      <a href="lesson9-ggplot-part2.html">Lesson 9: Plotting with ggplot - Part 2</a>
    </li>
    <li>
      <a href="lesson10-tidy-data.html">Lesson 10: Tidy Data</a>
    </li>
    <li>
      <a href="lesson11-data-import-and-types.html">Lesson 11: Data import, export, and conversion between data types</a>
    </li>
    <li>
      <a href="lesson12-relational-data.html">Lesson 12: Relational data</a>
    </li>
    <li>
      <a href="lesson13-debugging-getting-help.html">Lesson 13: Good coding practices, debugging strategies, and getting help</a>
    </li>
    <li>
      <a href="lesson14-for-loops.html">Lesson 14: Iteration - part 1</a>
    </li>
    <li>
      <a href="lesson15-for-loops-part2.html">Lesson 15: Iteration - part 2</a>
    </li>
    <li>
      <a href="lesson16-functions.html">Lesson 16: Functions</a>
    </li>
    <li>
      <a href="lesson17-factors.html">Lesson 17: Factors</a>
    </li>
    <li>
      <a href="lesson18-wrapup.html">Lesson 18: Wrapping up and learning more</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lab handouts</li>
    <li>
      <a href="lab1-rmarkdown.html">Lab 1: RMarkdown</a>
    </li>
    <li>
      <a href="lab2-rmarkdown-github.html">Lab 2: RMarkdown and GitHub</a>
    </li>
    <li>
      <a href="lab3-ggplot-website.html">Lab 3: Displaying data visualization on a website</a>
    </li>
    <li>
      <a href="lab4-ggplot-dplyr.html">Lab 4: Data exploration with the gapminder dataset</a>
    </li>
    <li>
      <a href="lab5-titanic.html">Lab 5: Data exploration with the Titanic dataset</a>
    </li>
    <li>
      <a href="lab6-tidy-data.html">Lab 6: Data cleaning and tidy data</a>
    </li>
    <li>
      <a href="lab7-relational-data.html">Lab 7: Relational data and tidy data</a>
    </li>
    <li>
      <a href="lab8-iteration.html">Lab 8: Iteration and conditional execution</a>
    </li>
    <li>
      <a href="lab9-function.html">Lab 9: Functions and iteration</a>
    </li>
  </ul>
</li>
<li>
  <a href="assignments.html">Assignments</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="installation.html">Installation guide</a>
    </li>
    <li>
      <a href="trouble-shooting.html">Trouble-shooting guide</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lesson 9: ggplot part 2</h1>

</div>


<p><br> <br></p>
<div id="readings" class="section level2">
<h2>Readings</h2>
<p><strong>Required</strong>:</p>
<ul>
<li><p>Review <a href="https://r4ds.hadley.nz/data-visualize">Chapter 1
in in R for Data Science (2e)</a> by Hadley Wickham, Mine
Çetinkaya-Rundel &amp; Garrett Grolemund</p></li>
<li><p>Skim the <a href="https://style.tidyverse.org/">The tidyverse
style guide</a> for inspiration - <strong>you don’t have to read the
whole guide carefully</strong></p></li>
</ul>
<p><br></p>
<p><strong>Additional resources</strong>:</p>
<ul>
<li><p><a
href="https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf">RStudio’s
ggplot2 cheat sheet</a></p></li>
<li><p><a href="http://varianceexplained.org/r/why-I-use-ggplot2/">“Why
I use ggplot2” - David Robinson Blog Post</a></p></li>
</ul>
<p><br></p>
</div>
<div id="announcements" class="section level2">
<h2>Announcements</h2>
<ul>
<li>Assignment 4 due this Thursday</li>
</ul>
<p><br></p>
</div>
<div id="todays-learning-objectives" class="section level2">
<h2>Today’s learning objectives</h2>
<p>The goal for today’s class is to return to <code>ggplot</code> to get
more practice with using this package for data visualization, cover a
few additional aspects of its functionality, and integrate the
<code>dplyr</code> data wrangling skills we learned last week to further
customize our plots.</p>
<p>By the end of this class, you should be able to:</p>
<ul>
<li>Use different geometric objects and aesthetics to explore various
plot types in <code>ggplot</code></li>
<li>Chain together steps for data wrangling (<code>dplyr</code>) and
plotting (<code>ggplot</code>)</li>
</ul>
<p>If we have time, we will wrap up with a brief discussion of good
coding practices.</p>
<p><br></p>
<p><strong>Acknowledgements</strong>: Today’s lecture borrows from
several excellent resources including the <a
href="https://rstudio-conf-2020.github.io/r-for-excel/">R for Excel
users</a> course by Julia Stewart Lowndes and Allison Horst and Chapter
3 of <a
href="https://r4ds.had.co.nz/data-visualisation.html#statistical-transformations">Grolemund
and Wickham’s R for Data Science</a>.</p>
<p><br> <br></p>
</div>
<div id="recap-on-the-grammar-of-graphics-implemented-in-ggplot"
class="section level2">
<h2>Recap on the Grammar of Graphics implemented in
<code>ggplot</code></h2>
<p>This overview is borrowed from the <a
href="https://stat545guidebook.netlify.com/intro-to-plotting-with-ggplot2-part-i.html">STAT545
course at UBC</a></p>
<p><img
src="https://cxlabsblog.files.wordpress.com/2017/10/2017-10-24-14_36_29-visualization-layers-of-ggplot-google-docs.png" />
<br></p>
<p>You can think of the grammar of graphics as a systematic approach for
describing the components of a graph. It has seven components (the ones
in <strong>bold</strong> are required to be specifed explicitly in
ggplot2):</p>
<ul>
<li><strong>Data</strong>
<ul>
<li>Exactly as it sounds: the data that you’re feeding into a plot.</li>
</ul></li>
<li><strong>Aesthetic mappings</strong>
<ul>
<li>This is a specification of how you will connect variables (columns)
from your data to a visual dimension. These visual dimensions are called
“aesthetics”, and can be (for example) horizontal positioning, vertical
positioning, size, colour, shape, etc.</li>
</ul></li>
<li><strong>Geometric objects</strong>
<ul>
<li>This is a specification of what object will actually be drawn on the
plot. This could be a point, a line, a bar, etc.</li>
</ul></li>
<li>Scales
<ul>
<li>This is a specification of how a variable is mapped to its
aesthetic. Will it be mapped linearly? On a log scale? Something
else?</li>
</ul></li>
<li>Statistical transformations
<ul>
<li>This is a specification of whether and how the data are
combined/transformed before being plotted. For example, in a bar chart,
data are transformed into their frequencies; in a box-plot, data are
transformed to a five-number summary.</li>
</ul></li>
<li>Coordinate system
<ul>
<li>This is a specification of how the position aesthetics (x and y) are
depicted on the plot. For example, rectangular/cartesian, or polar
coordinates.</li>
</ul></li>
<li>Facet
<ul>
<li>This is a specification of data variables that partition the data
into smaller “sub plots”, or panels.</li>
</ul></li>
</ul>
<p>These components are like parameters of statistical graphics,
defining the “space” of statistical graphics. In theory, there is a
one-to-one mapping between a plot and its grammar components, making
this a useful way to specify graphics.</p>
<p><br></p>
</div>
<div id="getting-started" class="section level2">
<h2>Getting started</h2>
<p>We’ll return to exploring the Coronavirus dataset. I’ll try to focus
on typical beginner’s errors along the way so we can get used to
trouble-shooting together.</p>
<p><br></p>
<p>First, let’s load our packages and read in our Coronavirus dataset.
You can choose to either work in an R-script or an RMarkdown document
today.</p>
<pre class="r"><code>suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(knitr))

coronavirus &lt;- read_csv(&#39;https://raw.githubusercontent.com/RamiKrispin/coronavirus/master/csv/coronavirus.csv&#39;)

# Has it been updated? Check the latest date?
max(coronavirus$date)</code></pre>
<pre><code>## [1] &quot;2023-01-04&quot;</code></pre>
<p><br> <br></p>
</div>
<div id="combining-dplyr-and-ggplot" class="section level2">
<h2>Combining <code>dplyr</code> and <code>ggplot</code></h2>
<p>Let’s start with summarizing the total number of cases by type as of
the most recent day in the dataset: 2023-01-04. Take a minute to try
this for yourself, then you can look at our approach.</p>
<p><br></p>
<details>
<summary>
click to see our approach
</summary>
<pre class="r"><code>total_cases &lt;- coronavirus |&gt; 
  group_by(type) |&gt;
  summarize(cases = sum(cases))

kable(total_cases)  # kable() just provides a nice output for the table</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">type</th>
<th align="right">cases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">confirmed</td>
<td align="right">662136356</td>
</tr>
<tr class="even">
<td align="left">death</td>
<td align="right">7507951</td>
</tr>
<tr class="odd">
<td align="left">recovery</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</details>
<p><br></p>
<p>Now, let’s plot the history of the daily counts of new confirmed
cases worldwide</p>
<pre class="r"><code># We first have to summarize the data, then plot those summary statistics
# Note that we can pipe dplyr output directly into ggplot
coronavirus |&gt;  
  filter(type == &quot;confirmed&quot;) |&gt; 
  group_by(date) |&gt; 
  summarize(total_cases = sum(cases)) |&gt; 
  ggplot(mapping = aes(x = date, y = total_cases)) +
  geom_line()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-3-1.png" width="672" /></p>
<p><br></p>
<p>If we want to play around with different geoms, we can store
<code>dplyr</code> data processing steps and initiation of the
<code>ggplot</code> as object <code>gg_base</code> so that we don’t need
to retype it each time</p>
<pre class="r"><code>gg_base &lt;- coronavirus |&gt;  
  filter(type == &quot;confirmed&quot;) |&gt; 
  group_by(date) |&gt; 
  summarize(total_cases = sum(cases)) |&gt; 
  ggplot(mapping = aes(x = date, y = total_cases)) </code></pre>
<p>Then when we want to draw the plot, we can just call that object and
specify the geom</p>
<pre class="r"><code>gg_base +
  geom_line()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-5-1.png" width="672" /></p>
<p><br> <br></p>
<p>Try these</p>
<pre class="r"><code>gg_base +
  geom_point()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>gg_base +
  geom_col(color = &quot;red&quot;)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-6-2.png" width="672" /></p>
<pre class="r"><code>gg_base +
  geom_area()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-6-3.png" width="672" /></p>
<p><br> <br></p>
</div>
<div id="customizing-plots" class="section level2">
<h2>Customizing plots</h2>
<p>First, a quick reminder on how we can customize some aesthetics
(e.g. colors, styles, axis labels, etc.) of our graphs based on
non-variable values.</p>
<blockquote>
<p>We can change the aesthetics of elements in a ggplot graph by adding
arguments within the layer where that element is created. Some common
arguments we’ll use first are:</p>
</blockquote>
<ul>
<li><code>color =</code>: update point or line colors</li>
<li><code>fill =</code>: update fill color for objects with areas</li>
<li><code>linetype =</code>: update the line type (dashed, long dash,
etc.)</li>
<li><code>shape =</code>: update the point style</li>
<li><code>size =</code>: update the element size (e.g. of points or line
thickness)</li>
<li><code>alpha =</code>: update element opacity (1 = opaque, 0 =
transparent)</li>
</ul>
<p><br></p>
<p>There are many overviews of the different arguments to
<code>linetype</code>, <code>shape</code> etc on the internet, e.g. <a
href="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/">here</a>.</p>
<p><br></p>
<p>Building on our first line graph, let’s update the line color to
“purple” and make the line type “dashed”:</p>
<pre class="r"><code>gg_base +
  geom_line(
    color = &quot;purple&quot;,
    linetype = &quot;dashed&quot;
  )</code></pre>
<p><img src="lesson9-files/unnamed-chunk-7-1.png" width="672" /></p>
<p>How do we know which color names ggplot will recognize? If you google
“R colors ggplot2” you’ll find a lot of good resources. Here’s one: <a
href="http://sape.inf.usi.ch/quick-reference/ggplot2/colour">SAPE
ggplot2 colors quick reference guide</a></p>
<p>Now let’s update the point, style and size of points on our previous
scatterplot graph using <code>color =</code>, <code>size =</code>,
<code>alpha =</code>, and <code>shape =</code> (see <code>?pch</code>
for the different point styles, which can be further customized).</p>
<pre class="r"><code>gg_base + 
  geom_point(color = &quot;purple&quot;,
             shape = 17,
             size = 4,
             alpha = 0.5)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-8-1.png" width="672" /></p>
<p><br> <br></p>
</div>
<div id="mapping-variables-onto-aesthetics" class="section level2">
<h2>Mapping variables onto aesthetics</h2>
<p>In the examples above, we have customized aesthetics based on
constants that we input as arguments (e.g., the color / style / size
isn’t changing based on a variable characteristic or value). Often,
however, we <strong>do</strong> want the aesthetics of a graph to depend
on a variable. To do that (as we’ve discussed earlier), we’ll
<strong>map variables onto graph aesthetics</strong>, meaning we’ll
change how an element on the graph looks based on a variable
characteristic (usually, character or value).</p>
<blockquote>
<p>When we want to customize a graph element based on a variable’s
characteristic or value, add the argument within <code>aes()</code> in
the appropriate <code>geom_*()</code> layer. In short, if updating
aesthetics based on a variable, make sure to put that argument inside of
<code>aes()</code>.</p>
</blockquote>
<p><strong>Example:</strong> Create a ggplot scatterplot graph where the
<strong>size</strong> and <strong>color</strong> of the points change
based on the <strong>number of cases</strong>, and make all points the
same level of opacity (<code>alpha = 0.5</code>). Notice the
<code>aes()</code> around the <code>size =</code> and
<code>color =</code> arguments.</p>
<p>Note: this is just for illustration of the functionality only - we
are showing the same information in redundant ways, which is typically
not helpful or necessary. Avoid excessive / overcomplicated aesthetic
mapping in data visualization.</p>
<pre class="r"><code>gg_base + 
  geom_point(
    aes(size = total_cases,
        color = total_cases),
    alpha = 0.5
  )</code></pre>
<p><img src="lesson9-files/unnamed-chunk-9-1.png" width="672" /></p>
<p>In the example above, notice that the two arguments that
<strong>do</strong> depend on variables are within <code>aes()</code>,
but since <code>alpha = 0.5</code> doesn’t depend on a variable then it
is <em>outside the <code>aes()</code> but still within the
<code>geom_point()</code> layer</em>.</p>
<p>When we map variables to aesthetics, <code>ggplot2</code> will
automatically assign a unique level of the aesthetic (here a unique
color) to each unique value of the variable, a process known as scaling.
<code>ggplot2</code> will also add a legend that explains which levels
correspond to which values.</p>
<p><br> <br></p>
</div>
<div id="ggplot2-complete-themes" class="section level2">
<h2>ggplot2 complete themes</h2>
<p>While every element of a ggplot graph is manually customizable, there
are also built-in themes (<code>theme_*()</code>) that you can add to
your ggplot code to make some major headway before making smaller tweaks
manually.</p>
<p>We talked about this briefly a few classes ago, but let’s explore a
little further. Here are a few to try today (but also notice all the
options that appear as we start typing <code>theme_</code> into our
ggplot graph code!):</p>
<ul>
<li><code>theme_light()</code></li>
<li><code>theme_minimal()</code></li>
<li><code>theme_bw()</code></li>
</ul>
<p>Also, check out more examples by scrolling down <a
href="https://ggplot2.tidyverse.org/reference/ggtheme.html#examples">here</a>.
Pick one that you like and update your previous plot.</p>
<p><br></p>
<p>Here, let’s update our previous graph with
<code>theme_minimal()</code>:</p>
<pre class="r"><code>gg_base + 
  geom_point(
    aes(size = total_cases,
        color = total_cases),
    alpha = 0.5
  ) +
  theme_minimal()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-10-1.png" width="672" />
<br></p>
<p>You can play around with other themes - see an overview and
instructions for how to customize themes <a
href="https://ggplot2-book.org/themes">here</a> and <a
href="https://r4ds.hadley.nz/communication">here</a>.</p>
<p><br></p>
<p>We could for example color the background of the legend</p>
<pre class="r"><code>gg_base + 
  geom_point(
    aes(size = total_cases,
        color = total_cases),
    alpha = 0.5) +
  theme_minimal() +
  theme(legend.background = element_rect(
    fill = &quot;lemonchiffon&quot;, 
    colour = &quot;grey50&quot;, 
    linewidth = 1
  ))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-11-1.png" width="672" /></p>
<p><br></p>
<p>Or we can remove the legend</p>
<pre class="r"><code>gg_base + 
  geom_point(
    aes(size = total_cases,
        color = total_cases),
    alpha = 0.5) +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-12-1.png" width="672" /></p>
<p><br></p>
<p>In addition to the themes built into ggplot, there are lots packages
that implement additional fun themes, see some examples <a
href="https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes//">here</a></p>
<p><br> <br></p>
</div>
<div id="updating-axis-labels-and-titles" class="section level2">
<h2>Updating axis labels and titles</h2>
<p>Use <code>labs()</code> to update axis labels, and add a title and/or
subtitle to your ggplot graph.</p>
<pre class="r"><code>gg_base +
  geom_line(linetype = &quot;dotted&quot;) +
  theme_bw() +
  labs(
    x = &quot;Date&quot;,
    y = &quot;Total confirmed cases&quot;,
    title = str_c(&quot;Daily counts of new Coronavirus cases recorded per &quot;, max(coronavirus$date)),
    subtitle = &quot;Global sums&quot;)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-13-1.png" width="672" /></p>
<p><br></p>
<p><strong>Note</strong>: If you want to update the formatting of axis
values (for example, to convert to comma format instead of scientific
format above), you can use the <code>scales</code> package options and
add <code>+ scale_y_continuous(labels = scales::comma)</code> (see more
from the <a href="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/">R
Cookbook</a>).</p>
<p><br> <br></p>
</div>
<div id="now-lets-split-the-case-counts-out-by-country"
class="section level2">
<h2>Now, let’s split the case counts out by country</h2>
<p><br></p>
<div id="your-turn" class="section level3">
<h3>Your turn</h3>
<blockquote>
<p>Take a minute to think about how you would generate a plot with a
separate line showing the daily reports of new confirmed cases in each
country.</p>
</blockquote>
<p><br></p>
<p>Here is some code we might try. Why does that not work?</p>
<pre class="r"><code>coronavirus |&gt;  
  filter(type == &quot;confirmed&quot;) |&gt; 
  group_by(date) |&gt; 
  summarize(total_cases = sum(cases)) |&gt; 
  ggplot() +
  geom_line(mapping = aes(x = date, y = total_cases, color = country))
# We have summarized out the country details (only one total count per day)</code></pre>
<p><br></p>
<p>We’ll have to group by both country and date. But why does this not
work?</p>
<pre class="r"><code>coronavirus |&gt;  
  filter(type == &quot;confirmed&quot;) |&gt; 
  group_by(country, date) |&gt; 
  summarize(total_cases = sum(cases)) |&gt; 
  ggplot(mapping = aes(x = date, y = total_cases)) +
  geom_line()
# Even though we have grouped the dataframe by country, that dplyr grouping does not get carried into ggplot</code></pre>
<p><br></p>
<p>Now let’s make ggplot group the data too by mapping country onto an
aesthetic</p>
<pre class="r"><code>coronavirus |&gt;  
  filter(type == &quot;confirmed&quot;) |&gt; 
  group_by(country, date) |&gt; 
  summarize(total_cases = sum(cases)) |&gt; 
  ggplot(mapping = aes(x = date, y = total_cases, color = country)) +
  geom_line()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-16-1.png" width="672" /></p>
<p><br></p>
<p>It looks like this is doing what we want, but it does not display
well. There are too many countries! We could play around with the layout
parameters to be able to see this plot. But let’s instead subset to only
show the 5 countries with the highest total counts of confirmed
cases.</p>
<pre class="r"><code>top5_countries &lt;- coronavirus |&gt; 
  filter(type == &quot;confirmed&quot;) |&gt;
  group_by(country) |&gt;
  summarize(total_cases = sum(cases)) |&gt;
  arrange(-total_cases) |&gt; 
  head(5) |&gt; 
  pull(country)</code></pre>
<p><br></p>
<p>Now let’s try to plot the daily counts of new cases just for those
countries</p>
<pre class="r"><code>coronavirus |&gt;  
  filter(type == &quot;confirmed&quot;, country %in% top5_countries) |&gt; 
  group_by(country, date) |&gt; 
  summarize(total_cases = sum(cases)) |&gt;  # Need this summarize because some countries have data broken down by Province.State
  ggplot(mapping = aes(x = date, y = total_cases, color = country)) +
  geom_line()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-18-1.png" width="672" /></p>
<p><br></p>
<p>Much better! But it looks messy because there are large large
negative values reported for certain days. Why could that be? In a real
data analysis, we would want to account for that, but for display
purposes, let’s just remove those rows from our dataset for now.</p>
<pre class="r"><code>coronavirus |&gt;  
  filter(type == &quot;confirmed&quot;, country %in% top5_countries, cases &gt;= 0) |&gt; 
  group_by(country, date) |&gt; 
  summarize(total_cases = sum(cases)) |&gt;  # Need this summarize because some countries have data broken down by Province.State
  ggplot(mapping = aes(x = date, y = total_cases, color = country)) +
  geom_line()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-19-1.png" width="672" /></p>
<p><br></p>
<p>We can also make a separate panel for each country</p>
<pre class="r"><code>coronavirus |&gt;  
  filter(type == &quot;confirmed&quot;, country %in% top5_countries, cases &gt;= 0) |&gt; 
  group_by(country, date) |&gt; 
  summarize(total_cases = sum(cases)) |&gt; 
  ggplot(mapping = aes(x = date, y = total_cases)) +
  geom_line() +
  facet_wrap(~country)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-20-1.png" width="672" /></p>
<p><br></p>
<p>Now let’s plot the cumulative sum of cases for each of those
countries instead</p>
<pre class="r"><code>coronavirus |&gt;  
  filter(type == &quot;confirmed&quot;, country %in% top5_countries, cases &gt;= 0) |&gt;
  group_by(country) |&gt; 
  arrange(date) |&gt; 
  mutate(cum_count = cumsum(cases)) |&gt; 
  ggplot(mapping = aes(x = date, y = cum_count, color = country)) +
  geom_line()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-21-1.png" width="672" /></p>
<p><br> <br></p>
</div>
</div>
<div id="bar-charts" class="section level2">
<h2>Bar charts</h2>
<p>Another common plot type are bar charts. There are two types of bar
charts in <code>ggplot</code>: <code>geom_bar()</code> and
<code>geom_col()</code>. <code>geom_bar()</code> makes the height of the
bar proportional to the number of records in each group (or if the
weight aesthetic is supplied, the sum of the weights). If you want the
heights of the bars to represent values in the data, use
<code>geom_col()</code> instead.</p>
<p>Since our dataset reports counts of cases, let’s first start with
<code>geom_col()</code> Let’s compare the total number of cases in each
of the top 5 countries with the highest total counts</p>
<pre class="r"><code>coronavirus |&gt; 
  filter(type == &quot;confirmed&quot;, country %in% top5_countries, cases &gt;= 0) |&gt;
  group_by(country) |&gt;
  summarize(cases = sum(cases)) |&gt;
  ggplot() +
  geom_col(aes(x = country, y = cases), color = &quot;black&quot;)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-22-1.png" width="672" /></p>
<p><br></p>
<p>Next, let’s make a stacked barplot that also shows the total number
of deaths in each country. First we’ll need to compute the total counts
for each type of case, then we can use the <code>fill</code> aesthetic
to create the stacked bars</p>
<pre class="r"><code>coronavirus |&gt; 
  filter(type == &quot;confirmed&quot; | type == &quot;death&quot;, country %in% top5_countries, cases &gt;= 0) |&gt;
  group_by(country, type) |&gt;
  summarize(cases = sum(cases)) |&gt;
  ggplot() +
  geom_col(aes(x = country, y = cases, fill = type))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-23-1.png" width="672" /></p>
<p><br></p>
<p>We may want to flip this around</p>
<pre class="r"><code>coronavirus |&gt; 
  filter(type == &quot;confirmed&quot; | type == &quot;death&quot;, country %in% top5_countries, cases &gt;= 0) |&gt;
  group_by(country, type) |&gt;
  summarize(cases = sum(cases)) |&gt;
  ggplot() +
  geom_col(aes(x = country, y = cases, fill = type)) +
  coord_flip()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-24-1.png" width="672" /></p>
<p>This is useful because it puts the proportions in relation to the
total daily counts. But it can be hard to compare proportions. We can
make all bars the same height with ‘position adjustment’</p>
<pre class="r"><code>coronavirus |&gt; 
  filter(type == &quot;confirmed&quot; | type == &quot;death&quot;, country %in% top5_countries, cases &gt;= 0) |&gt;
  group_by(country, type) |&gt;
  summarize(cases = sum(cases)) |&gt;
  ggplot() +
  geom_col(aes(x = country, y = cases, fill = type), position = &quot;fill&quot;) +
  coord_flip()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-25-1.png" width="672" /></p>
<p>While looking at the proportions of case types is helpful for
comparing patterns, it doesn’t allow for comparison of the magnitude of
case counts. We can do this better by scaling the bars by the raw case
counts (not mapping a variable to the <code>fill</code> aesthetic), as
we did above.</p>
<p><br></p>
<p>We can also get the bars for the different types of cases each day
stacked next to each other with another position adjustment option</p>
<pre class="r"><code>coronavirus |&gt; 
  filter(type == &quot;confirmed&quot; | type == &quot;death&quot;, country %in% top5_countries, cases &gt;= 0) |&gt;
  group_by(country, type) |&gt;
  summarize(cases = sum(cases)) |&gt;
  ggplot() +
  geom_col(aes(x = country, y = cases, fill = type), position = &quot;dodge&quot;)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-26-1.png" width="1440" /></p>
<p><br> <br></p>
<p>Now, let’s explore a different question. Let’s compare for how many
days each of the top five countries have had &gt; 100,000 new confirmed
cases. For this we will need to count rows within grouped variables, so
we’ll use the <code>geom_bar()</code></p>
<pre class="r"><code>coronavirus |&gt; 
  filter(type == &quot;confirmed&quot;, country %in% top5_countries, cases &gt;= 0) |&gt;
  group_by(date, country) |&gt; 
  summarize(cases = sum(cases)) |&gt; 
  filter(cases &gt;100000) |&gt; 
  ggplot() +
  geom_bar(aes(country))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-27-1.png" width="672" /></p>
<p><br></p>
<p>Alternatively, we could also pre-compute these counts and plot them
with <code>geom_col()</code> like above, but sometimes it’s convenient
to have ggplot compute the counts of observations directly with
<code>geom_bar()</code></p>
<pre class="r"><code>coronavirus |&gt; 
  filter(type == &quot;confirmed&quot;, country %in% top5_countries, cases &gt;= 0) |&gt;
  group_by(date, country) |&gt; 
  summarize(cases = sum(cases)) |&gt; 
  filter(cases &gt;100000) |&gt; 
  # note here that we need to change the grouping to now just be by country
  group_by(country) |&gt;   
  summarize(count = n()) |&gt; 
  ggplot() +
  geom_col(aes(country, y = count))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-28-1.png" width="672" /></p>
<p><br> <br></p>
</div>
<div id="plotting-with-labels" class="section level2">
<h2>Plotting with labels</h2>
<p>To explore different types of x-y scatterplots, let’s return to the
vaccination data we also looked at during the last lecture. Let’s first
load it back in:</p>
<pre class="r"><code>vacc &lt;- read_csv(&quot;https://raw.githubusercontent.com/RamiKrispin/coronavirus/main/csv/covid19_vaccine.csv&quot;)</code></pre>
<p><br></p>
<p>Remember, this dataset shows cumulate counts, so let’s grab the
counts from the most recent date included in the dataset 2023-03-09.
We’ll also remove rows with missing data for variables we need (this is
typically not necessary as those lines will automatically be excluded
from plots, but we do it here because some of those rows have extreme
values for other variables)</p>
<pre class="r"><code># create a &quot;total to date&quot; subset of the data
vacc_ttd &lt;- vacc |&gt; 
  filter(date == max(date), !is.na(people_at_least_one_dose), !is.na(population))

# Let&#39;s look at our new tibble so make sure it makes sense
vacc_ttd</code></pre>
<pre><code>## # A tibble: 191 × 15
##    date       country_region      continent_name continent_code combined_key    
##    &lt;date&gt;     &lt;chr&gt;               &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;           
##  1 2023-03-09 Afghanistan         Asia           AS             Afghanistan     
##  2 2023-03-09 Albania             Europe         EU             Albania         
##  3 2023-03-09 Algeria             Africa         AF             Algeria         
##  4 2023-03-09 Andorra             Europe         EU             Andorra         
##  5 2023-03-09 Angola              Africa         AF             Angola          
##  6 2023-03-09 Antigua and Barbuda North America  &lt;NA&gt;           Antigua and Bar…
##  7 2023-03-09 Argentina           South America  SA             Argentina       
##  8 2023-03-09 Armenia             Asia           AS             Armenia         
##  9 2023-03-09 Australia           Oceania        OC             Australia       
## 10 2023-03-09 Austria             Europe         EU             Austria         
## # ℹ 181 more rows
## # ℹ 10 more variables: doses_admin &lt;dbl&gt;, people_at_least_one_dose &lt;dbl&gt;,
## #   population &lt;dbl&gt;, uid &lt;dbl&gt;, iso2 &lt;chr&gt;, iso3 &lt;chr&gt;, code3 &lt;dbl&gt;,
## #   fips &lt;lgl&gt;, lat &lt;dbl&gt;, long &lt;dbl&gt;</code></pre>
<p><br></p>
<p>We can start by just making a simple plot of the number of fully
vaccinated people vs. the total population size in different
countries</p>
<pre class="r"><code>vacc_ttd |&gt; 
  ggplot() +
  geom_point(mapping = aes(population, people_at_least_one_dose))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-31-1.png" width="672" /></p>
<p><br></p>
<p>That’s nice, but it would be useful to know which country is
represented by each dot. <code>geom_label()</code> is our tool for
that.</p>
<pre class="r"><code>vacc_ttd |&gt; 
  ggplot() +
  geom_label(mapping = aes(population, people_at_least_one_dose, label = country_region))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-32-1.png" width="672" /></p>
<p><br></p>
<p>Let’s do a few things to make this easier to read</p>
<p>We can remove countries with a small population sizes, and log
transform the population sizes</p>
<pre class="r"><code>vacc_ttd |&gt; 
  filter(population &gt; 50000000) |&gt; 
  ggplot() +
  geom_label(mapping = aes(log(population), people_at_least_one_dose, label = country_region))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-33-1.png" width="672" /></p>
<p><br></p>
<p>Or, we can zoom in on the part of the plot where almost all countries
other than China and India are clustered together. We can do this in a
few different ways. One is to just filter out rows with large population
size (e.g. countries with population sizes over 500 million).</p>
<pre class="r"><code>vacc_ttd |&gt; 
  filter(population &lt; 5*10^8) |&gt; 
  ggplot() +
  geom_label(mapping = aes(population, people_at_least_one_dose, label = country_region))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-34-1.png" width="672" /></p>
<p><br></p>
<p>Or we can just zoom in by adjusting what parts of the axes to
display</p>
<pre class="r"><code>vacc_ttd |&gt; 
  ggplot() +
  geom_label(mapping = aes(population, people_at_least_one_dose, label = country_region)) +
  coord_cartesian(xlim = c(0,4*10^8), ylim = c(0, 3*10^8))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-35-1.png" width="672" /></p>
<p><br></p>
<p>There are lots of other ways we can adjust label plotting. See
e.g. <a
href="https://www.r-graph-gallery.com/275-add-text-labels-with-ggplot2.html">here</a>
or a more comprehensive overview in the book <a
href="https://ggplot2-book.org/annotations.html">chapter 8 of the book
“ggplot2: Elegant Graphics for Data Analysis”</a></p>
<p><br> <br></p>
<div id="bonus-spatial-plotting" class="section level3">
<h3>Bonus: Spatial plotting</h3>
<div id="map-of-newly-reported-cases" class="section level4">
<h4>Map of newly reported cases</h4>
<p>With some additional packages, we can also plot geographical patterns
on a map. We can, for example, show which countries have new counts of
&gt;5000 new confirmed cases on the most recent day from this dataset
and scale the points with case counts.</p>
<pre class="r"><code>library(&quot;rnaturalearth&quot;) # install.packages(&quot;rnaturalearth&quot;)
library(&quot;rnaturalearthdata&quot;) # install.packages(&quot;rnaturalearthdata&quot;)
library(&quot;rgeos&quot;) #install.packages(&quot;rgeos&quot;)
world &lt;- ne_countries(scale = &quot;medium&quot;, returnclass = &quot;sf&quot;)
filter(coronavirus, date == max(coronavirus$date), type == &quot;confirmed&quot;, cases &gt; 5000) |&gt;
  ggplot() +
  geom_sf(data = world) +
  geom_point(aes(x=long, y=lat, size=cases), color=&quot;red&quot;, fill=&quot;red&quot;, alpha=0.5, shape=21) </code></pre>
<p><br> <br></p>
</div>
</div>
</div>
<div id="exercise" class="section level2">
<h2>Exercise</h2>
<p>Come up with an interesting question you want to explore in the
Coronavirus dataset with a plot. Try to figure out how to plot it
(remember: Google is your friend).</p>
<p><br></p>
<p>Examples of questions you could explore:</p>
<ul>
<li><p>We saw earlier that India has had a lower death count per number
of confirmed cases than other countries, while Mexico had a higher death
count per number of confirmed cases. Has this been a consistent pattern
throughout the pandemic?</p></li>
<li><p>For how long has the US been the country with the greatest number
of confirmed cases?</p></li>
<li><p>Have the global daily death counts peaked and declined or are
they still rising? What about within individual countries?</p></li>
</ul>
<p><br> <br></p>
</div>
<div id="some-example-plots" class="section level2">
<h2>Some example plots:</h2>
<p><br></p>
<div id="trend-in-cumulative-case-count" class="section level4">
<h4>Trend in cumulative case count</h4>
<pre class="r"><code>## linear scale
group_by(coronavirus, date, type) |&gt;
  summarise(cases = sum(cases)) |&gt; 
  group_by(type) |&gt;
  mutate(cases=cumsum(cases)) |&gt;
  ggplot() +
  geom_line(aes(x=date, y=cases, color=type))</code></pre>
<p><img src="lesson9-files/unnamed-chunk-37-1.png" width="672" /></p>
<pre class="r"><code>## log scale
group_by(coronavirus, date, type) |&gt;
  summarise(cases = sum(cases)) |&gt; 
  group_by(type) |&gt;
  mutate(cases=cumsum(cases)) |&gt;
  ggplot() +
  geom_line(aes(x=date, y=log(cases), color=type))</code></pre>
<pre><code>## Warning in log(cases): NaNs produced</code></pre>
<p><img src="lesson9-files/unnamed-chunk-37-2.png" width="672" /></p>
<p><br></p>
</div>
<div
id="trend-in-cumulative-case-count-in-the-5-most-infected-countries"
class="section level4">
<h4>Trend in cumulative case count in the 5 most infected countries</h4>
<pre class="r"><code>## linear scale
filter(coronavirus, country %in% top5_countries) |&gt;
  group_by(country, date, type) |&gt;
  summarise(cases = sum(cases)) |&gt; 
  group_by(country, type) |&gt;
  mutate(cases=cumsum(cases)) |&gt;
  ggplot() +
  geom_line(aes(x=date, y=cases/1000, color=type)) +
  ylab(&quot;cumulative count (in thousand)&quot;) +
  facet_wrap(~country, scales = &quot;free_y&quot;)</code></pre>
<p><img src="lesson9-files/unnamed-chunk-38-1.png" width="1440" /></p>
<p><br></p>
</div>
<div id="trend-in-cumulative-death-rate" class="section level4">
<h4>Trend in cumulative death rate</h4>
<pre class="r"><code>group_by(coronavirus, date, type) |&gt;
  summarise(cases = sum(cases)) |&gt; 
  group_by(type) |&gt;
  mutate(cases=cumsum(cases)) |&gt;
  pivot_wider(names_from = type, values_from = cases) |&gt;
  mutate(death_rate = death/confirmed) |&gt;
  ggplot(aes(x=date, y=death_rate)) +
  geom_line()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-39-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="trend-in-cumulative-death-rate-in-5-most-infected-countries"
class="section level4">
<h4>Trend in cumulative death rate in 5 most infected countries</h4>
<pre class="r"><code>filter(coronavirus, country %in% top5_countries) |&gt;
  group_by(country, date, type) |&gt;
  summarise(cases = sum(cases)) |&gt; 
  group_by(country, type) |&gt;
  mutate(cases=cumsum(cases)) |&gt;
  pivot_wider(names_from = type, values_from = cases) |&gt;
  mutate(death_rate = death/confirmed) |&gt;
  ggplot(aes(x=date, y=death_rate)) +
  geom_line() +
  facet_wrap(~country, scales = &quot;free_y&quot;)</code></pre>
<pre><code>## Warning: Removed 35 rows containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<p><img src="lesson9-files/unnamed-chunk-40-1.png" width="672" /></p>
<p><br></p>
</div>
<div
id="countries-that-had-their-first-reported-coronavirus-case-in-january"
class="section level4">
<h4>Countries that had their first reported coronavirus case in
January</h4>
<pre class="r"><code>filter(coronavirus, type==&quot;confirmed&quot;, cases&gt;0) |&gt;
  group_by(country, date) |&gt;
  summarise() |&gt;
  group_by(country) |&gt;
  filter(date==min(date)) |&gt;
  ungroup() |&gt;
  arrange(date) |&gt;
  mutate(rank=row_number(date)) |&gt;
  filter(months(date)==&quot;January&quot;, lubridate::year(date)==2020) |&gt;
  ggplot(aes(x=date, y=rank)) +
  geom_label(aes(label=country)) +
  theme_minimal()</code></pre>
<p><img src="lesson9-files/unnamed-chunk-41-1.png" width="960" /></p>
<div class="tocify-extend-page" data-unique="tocify-extend-page"
style="height: 0;">

</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
