<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lesson 11: Data import, export, and conversion between data types</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Collaborative and Reproducible Data Science in R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture notes</li>
    <li>
      <a href="lesson1-rstudio.html">Lesson 1: R Studio</a>
    </li>
    <li>
      <a href="lesson2-rmarkdown-github.html">Lesson 2: RMarkdown and GitHub</a>
    </li>
    <li>
      <a href="lesson3-version-control.html">Lesson 3: Version control and the Git/GitHub workflow</a>
    </li>
    <li>
      <a href="lesson4-collaboration.html">Lesson 4: Collaborating with GitHub - Part 1</a>
    </li>
    <li>
      <a href="lesson5-collaboration-part2.html">Lesson 5: Collaborating with GitHub - Part 2</a>
    </li>
    <li>
      <a href="lesson6-ggplot-part1.html">Lesson 6: Plotting with ggplot - Part 1</a>
    </li>
    <li>
      <a href="lesson7-data-wrangling1.html">Lesson 7: Data wrangling - Part 1</a>
    </li>
    <li>
      <a href="lesson8-data-wrangling2.html">Lesson 8: Data wrangling - Part 2</a>
    </li>
    <li>
      <a href="lesson9-ggplot-part2.html">Lesson 9: Plotting with ggplot - Part 2</a>
    </li>
    <li>
      <a href="lesson10-tidy-data.html">Lesson 10: Tidy Data</a>
    </li>
    <li>
      <a href="lesson11-data-import-and-types.html">Lesson 11: Data import, export, and conversion between data types</a>
    </li>
    <li>
      <a href="lesson12-relational-data.html">Lesson 12: Relational data</a>
    </li>
    <li>
      <a href="lesson13-for-loops.html">Lesson 13: Iteration - part 1</a>
    </li>
    <li>
      <a href="lesson14-for-loops-part2.html">Lesson 14: Iteration - part 2</a>
    </li>
    <li>
      <a href="lesson15-debugging-getting-help.html">Lesson 15: Good coding practices, debugging strategies, and getting help</a>
    </li>
    <li>
      <a href="lesson16-functions.html">Lesson 16: Functions</a>
    </li>
    <li>
      <a href="lesson17-factors.html">Lesson 17: Factors</a>
    </li>
    <li>
      <a href="lesson18-wrapup.html">Lesson 18: Wrapping up and learning more</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lab handouts</li>
    <li>
      <a href="lab1-rmarkdown.html">Lab 1: RMarkdown</a>
    </li>
    <li>
      <a href="lab2-rmarkdown-github.html">Lab 2: RMarkdown and GitHub</a>
    </li>
    <li>
      <a href="lab3-ggplot-website.html">Lab 3: Displaying data visualization on a website</a>
    </li>
    <li>
      <a href="lab4-ggplot-dplyr.html">Lab 4: Data exploration with the gapminder dataset</a>
    </li>
    <li>
      <a href="lab5-titanic.html">Lab 5: Data exploration with the Titanic dataset</a>
    </li>
    <li>
      <a href="lab6-tidy-data.html">Lab 6: Data cleaning and tidy data</a>
    </li>
    <li>
      <a href="lab7-relational-data.html">Lab 7: Relational data and tidy data</a>
    </li>
    <li>
      <a href="lab8-iteration.html">Lab 8: Iteration and conditional execution</a>
    </li>
    <li>
      <a href="lab9-function.html">Lab 9: Functions and iteration</a>
    </li>
  </ul>
</li>
<li>
  <a href="assignments.html">Assignments</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="installation.html">Installation guide</a>
    </li>
    <li>
      <a href="trouble-shooting.html">Trouble-shooting guide</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lesson 11: Data import, export, and
conversion between data types</h1>

</div>


<p><br> <br></p>
<div id="readings" class="section level2">
<h2>Readings</h2>
<p><br></p>
<div id="required" class="section level4">
<h4>Required:</h4>
<ul>
<li><a
href="https://b-rodrigues.github.io/modern_R/data-types-and-objects.html">Chapter
3: Data types and objects</a> in Modern R with the tidyverse by Bruno
Rodrigues</li>
</ul>
<p><br></p>
<ul>
<li>Chapters <a href="https://r4ds.had.co.nz/tibbles.html">10</a>, <a
href="https://r4ds.had.co.nz/data-import.html">11</a>, <a
href="https://r4ds.had.co.nz/strings.html#introduction-8">14.1 +
14.2</a>, <a href="https://r4ds.had.co.nz/factors.html">15.1 + 15.2</a>
and <a href="https://r4ds.had.co.nz/dates-and-times.html">16</a> in R
for Data Science by Hadley Wickham &amp; Garrett Grolemund [That sounds
like a lot, but all the sections are pretty short and contain important
information. Chapters 10 and 11 are the most essential if you don’t have
time to read them all]</li>
</ul>
<p><br></p>
</div>
<div id="other-resources" class="section level4">
<h4>Other resources:</h4>
<ul>
<li>The rest of Chapters <a
href="https://r4ds.had.co.nz/strings.html">14-16</a> in R for Data
Science by Hadley Wickham &amp; Garrett Grolemund</li>
</ul>
<p><br> <br></p>
</div>
</div>
<div id="plan-for-today-and-learning-objectives" class="section level2">
<h2>Plan for today and learning objectives</h2>
<p>So far, we’ve mostly worked with datasets provided in R packages.
Today we’ll look at how we get our own data imported and how we export
processed data files, summary tables, and plots.</p>
<p>By the end of today’s class, you should be able to:</p>
<ul>
<li>Read data files into R with a variety of <code>readr</code>
functions</li>
<li>Parse different types of data and make sure R is interpreting your
variable types correctly</li>
<li>Use <code>janitor::clean_names()</code> to make column headers more
manageable</li>
<li>Write text output to your disk</li>
<li>Save plots</li>
</ul>
<p><br> <br></p>
</div>
<div id="loading-packages" class="section level2">
<h2>Loading packages</h2>
<pre class="r"><code>library(tidyverse)</code></pre>
<p><br> <br></p>
</div>
<div id="data-import" class="section level2">
<h2>Data import</h2>
<div id="reading-data-into-rstudio" class="section level3">
<h3>Reading data into RStudio</h3>
<p>So far, we’ve been working with datasets that are built into R or we
have just provided code to run to import data into R.</p>
<p>When working in the tidyverse, the most common import function we
will use are the <code>read_xx()</code> functions from the tidyverse
package <code>readr</code>.</p>
<ul>
<li><p><code>read_csv()</code> reads comma delimited files,
<code>read_csv2()</code> reads semicolon separated files (common in
countries where <code>,</code> is used as the decimal place),
<code>read_tsv()</code> reads tab delimited files, and
<code>read_delim()</code> reads in files with any delimiter.</p></li>
<li><p><code>read_fwf()</code> reads fixed width files. You can specify
fields either by their widths with <code>fwf_widths()</code> or their
position with <code>fwf_positions()</code>. <code>read_table()</code>
reads a common variation of fixed width files where columns are
separated by white space.</p></li>
</ul>
<p>All the <code>readr::read_xx()</code> functions have many additional
options including the ability to skip columns, skip rows, rename columns
on import, trim whitespace, and much more. They all use the same syntax,
so once you get familiar with one, you can easily apply your knowledge
to all the other functions in <code>readr</code>.</p>
<p>You can examine the options by looking at the documentation, e.g
<code>?read_csv()</code>. There is also a very useful overview in <a
href="https://r4ds.had.co.nz/data-import.html">Chapter 11 of Grolemund
and Wickham’s R for Data Science</a></p>
<p><br></p>
<p>We can also read directly from spreadsheet formats:</p>
<ul>
<li><p><code>readxl::read_excel()</code> reads directly from Excel
spreadsheets</p></li>
<li><p><code>googlesheets4::read_sheet()</code> from the package <a
href="https://googlesheets4.tidyverse.org/">googlesheets4</a> reads in
data directly from Google Sheets</p></li>
</ul>
<p><br></p>
<p>For all of these, we can either read in data from a file path or
directly from a URL.</p>
<p><br></p>
<p>To illustrate, let’s revisit <a
href="https://github.com/jennybc/lotr-tidy/blob/master/01-intro.md">Jenny
Bryan’s Lord of the Rings Data</a> that we worked with last class.</p>
<p>We can import directly from Jenny’s GitHub page:</p>
<pre class="r"><code>lotr &lt;- read_csv(&quot;https://raw.githubusercontent.com/jennybc/lotr-tidy/master/data/lotr_tidy.csv&quot;)</code></pre>
<pre><code>## Rows: 18 Columns: 4
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (3): Film, Race, Gender
## dbl (1): Words
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p><br></p>
<p>We can also use the same function to read directly from my disk. To
get a local copy, let me first save it with readr’s
<code>write_csv()</code> function (we’ll get back to how that function
works a little later). I’ll first make sure I have a good place to save
it. If you don’t already have a subdirectory named <code>datasets</code>
or similar, create one within your home directory by clicking “New
Folder” in your file pane.</p>
<pre class="r"><code>write_csv(lotr, file = &quot;../datasets/lotr_tidy.csv&quot;)</code></pre>
<p><br></p>
<p>Inspect the file to make sure it got created, then load it into R
with the <code>read_csv()</code> function (make sure you specify the
path to where you actually saved it).</p>
<pre class="r"><code>lotr_tidy &lt;- read_csv(&quot;../datasets/lotr_tidy.csv&quot;)</code></pre>
<pre><code>## Rows: 18 Columns: 4
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (3): Film, Race, Gender
## dbl (1): Words
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p><br></p>
<p><code>read_csv()</code> uses the first line of the data for the
column names, which is a very common convention. We can play around with
tweaking our local copy of the data file to make use of the options for
tweaking this behavior. For example, if there are a few lines of
metadata at the top of the file, we can use <code>skip = n</code> to
skip the first n lines; or use <code>comment = "#"</code> to drop all
lines that start with (e.g.) #. When the data do not have column names,
we can use <code>col_names = FALSE</code> to tell
<code>read_csv()</code> not to treat the first row as headings, and
instead label them sequentially from <code>X1</code> to
<code>Xn</code>.</p>
<p><br></p>
<p>We can also make an Excel file with the same data and try reading in
from that (note that you need to first install the <code>readxl</code>
package, if you don’t already have it)</p>
<pre class="r"><code>library(readxl) ## install.packages(&quot;readxl&quot;)

lotr_xlsx &lt;- read_xlsx(&quot;datasets/LOTR.xlsx&quot;)

# you can specify which sheet to read the data from with the &quot;sheet = &quot; argument</code></pre>
<p><br></p>
<p>Or we can read from a google sheet! If you want to just read from
public sheets (set to “Anyone on the internet with this link can
view/edit”), you want to first run <code>gs4_deauth()</code> to indicate
there is no need for a token. If you want to access private sheets,
check the instructions for configuring an authenticated user <a
href="https://search.r-project.org/CRAN/refmans/googlesheets4/html/gs4_auth.html">here</a>.</p>
<pre class="r"><code>library(googlesheets4) ## install.packages(&quot;googlesheets4&quot;)

gs4_deauth()
lotr_gs &lt;- read_sheet(&quot;https://docs.google.com/spreadsheets/d/1X98JobRtA3JGBFacs_JSjiX-4DPQ0vZYtNl_ozqF6IE/edit#gid=754443596&quot;)</code></pre>
<p><br> <br></p>
</div>
<div id="why-use-the-tidyversereadr-import-functions-instead-of-base-r"
class="section level3">
<h3>Why use the tidyverse/readr import functions instead of base-R?</h3>
<blockquote>
<p>From <a
href="https://r4ds.had.co.nz/data-import.html#compared-to-base-r">R4DS</a></p>
</blockquote>
<p>If you’ve used R before, you might wonder why we’re not using
read.csv(). There are a few good reasons to favor readr functions over
the base equivalents:</p>
<ul>
<li><p>They are typically much faster (~10x) than their base-R
equivalents (e.g. <code>read.cvs()</code>). Long running jobs have a
progress bar, so you can see what’s happening. If you’re looking for raw
speed, try data.table::fread(). It doesn’t fit quite so well into the
tidyverse, but it can be quite a bit faster.</p></li>
<li><p>They produce tibbles, they don’t convert character vectors to
factors, use row names, or munge the column names. These are common
sources of frustration with the base R functions.</p></li>
<li><p>They are more reproducible. Base R functions inherit some
behaviour from your operating system and environment variables, so
import code that works on your computer might not work on someone
else’s.</p></li>
</ul>
<p><br> <br></p>
</div>
<div id="cleaning-up-variables" class="section level3">
<h3>Cleaning up variables</h3>
<p>Once we have the data read in, we may need to clean up several of our
variables. Parsing functions are really useful for that.</p>
<p><br></p>
<div id="parsing-numbers" class="section level4">
<h4>Parsing numbers</h4>
<p>It seems like it should be straightforward to parse a number, but
three problems make it tricky:</p>
<ol style="list-style-type: decimal">
<li><p>People write numbers differently in different parts of the world.
For example, some countries use . in between the integer and fractional
parts of a real number, while others use ,.</p></li>
<li><p>Numbers are often surrounded by other characters that provide
some context, like “$1000” or “10%”.</p></li>
<li><p>Numbers often contain “grouping” characters to make them easier
to read, like “1,000,000”, and these grouping characters vary around the
world.</p></li>
</ol>
<p>To address the first problem, <code>readr</code> has the notion of a
“locale”, an object that specifies parsing options that differ from
place to place. When parsing numbers, the most important option is the
character you use for the decimal mark. You can override the default
value of . by creating a new locale and setting the decimal_mark
argument. We’ll illustrate this with <code>parse_xx()</code> functions.
Basically, every <code>col_xx()</code> function has a corresponding
<code>parse_xx()</code> function. You use <code>parse_xx()</code> when
the data is in a character vector in R already; you use
<code>col_xx()</code> when you want to tell readr how to load the
data.</p>
<pre class="r"><code>parse_double(&quot;1.23&quot;)</code></pre>
<pre><code>## [1] 1.23</code></pre>
<pre class="r"><code>parse_double(&quot;1,23&quot;, locale = locale(decimal_mark = &quot;,&quot;))</code></pre>
<pre><code>## [1] 1.23</code></pre>
<p><br></p>
<p><code>readr</code>’s default locale is US-centric, because generally
R is US-centric (e.g. the documentation of base R is written in American
English). An alternative approach would be to try and guess the defaults
from your operating system. This is hard to do well, and, more
importantly, makes your code fragile: even if it works on your computer,
it might fail when you email it to a colleague in another country.</p>
<p><code>parse_number()</code> addresses the second problem: it ignores
non-numeric characters before and after the number. This is particularly
useful for currencies and percentages, but also works to extract numbers
embedded in text.</p>
<pre class="r"><code>parse_number(&quot;$100&quot;)</code></pre>
<pre><code>## [1] 100</code></pre>
<pre class="r"><code>parse_number(&quot;20%&quot;)</code></pre>
<pre><code>## [1] 20</code></pre>
<pre class="r"><code>parse_number(&quot;It cost $123.45&quot;)</code></pre>
<pre><code>## [1] 123.45</code></pre>
<p><br></p>
<p>The final problem is addressed by the combination of
<code>parse_number()</code> and the locale as
<code>parse_number()</code> will ignore the “grouping mark”:</p>
<pre class="r"><code># Used in America
parse_number(&quot;$123,456,789&quot;)</code></pre>
<pre><code>## [1] 123456789</code></pre>
<pre class="r"><code># Used in many parts of Europe
parse_number(&quot;123.456.789&quot;, locale = locale(grouping_mark = &quot;.&quot;))</code></pre>
<pre><code>## [1] 123456789</code></pre>
<pre class="r"><code># Used in Switzerland
parse_number(&quot;123&#39;456&#39;789&quot;, locale = locale(grouping_mark = &quot;&#39;&quot;))</code></pre>
<pre><code>## [1] 123456789</code></pre>
<p><br> <br></p>
</div>
<div id="dates" class="section level4">
<h4>Dates</h4>
<p>Dates can be tricky! If you work with date data, I suggest you review
chapters <a
href="https://r4ds.had.co.nz/data-import.html#readr-datetimes">11.3.4</a>
and <a href="https://r4ds.had.co.nz/dates-and-times.html">16</a> in
R4DS.</p>
<p><br> <br></p>
</div>
<div id="converting-between-data-types-with-parse_x-functions"
class="section level4">
<h4>Converting between data types with <code>parse_x()</code>
functions</h4>
<p>We can use the <code>parse_xx()</code> functions in combination with
<code>mutate()</code> to clean up values in a variable.</p>
<p>Let’s have a look at how to clean up this dataset:</p>
<pre class="r"><code>mess = read_tsv(&quot;https://raw.githubusercontent.com/nt246/NTRES6940-data-science/master/datasets/messy_data.tsv&quot;, locale = locale(decimal_mark = &quot;,&quot;))</code></pre>
<pre><code>## Rows: 3 Columns: 3
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;\t&quot;
## chr (2): item, price
## dbl (1): size
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code># What happens if we run this without the locale argument?</code></pre>
<p>Let’s clean up the <code>price</code> column</p>
<pre class="r"><code>mess |&gt; 
  mutate(price = parse_number(price))</code></pre>
<pre><code>## # A tibble: 3 × 3
##   item  price  size
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 a        45   3.5
## 2 b         5   2.7
## 3 c         3   2.9</code></pre>
<p><br> <br></p>
</div>
</div>
</div>
<div id="cleaning-up-column-names" class="section level2">
<h2>Cleaning up column names</h2>
<p>Sometimes you’ll encounter datasets with really inconsistent column
names. Inconsistent naming is not a problem per se for our ability to
work with a dataset, but it’s a bit annoying to look at and to have to
remember when calling variable names. In other cases, spaces and special
characters in column names of data you import can actually cause
problems downstream, so we often may want to clean them up.</p>
<p>The <code>janitor</code> package by Sam Firke is a great collection
of functions for some quick data cleaning, like:</p>
<ul>
<li><code>janitor::clean_names()</code>: update column headers to a case
of your choosing</li>
<li><code>janitor::get_dupes()</code>: see all rows that are duplicates
within variables you choose</li>
<li><code>janitor::remove_empty()</code>: remove empty rows and/or
columns</li>
<li><code>janitor::adorn_*()</code>: jazz up tables</li>
</ul>
<p>Here, we’ll use <code>janitor::clean_names()</code> to convert all
column headers in a messy dataset to a more convenient case - the
default is <strong>lower_snake_case</strong>, which means all spaces and
symbols are replaced with an underscore (or a word describing the
symbol), all characters are lowercase, and a few other nice
adjustments.</p>
<p>For example, <code>janitor::clean_names()</code> would update these
nightmare column names into much nicer forms:</p>
<ul>
<li><code>My...RECENT-income!</code> becomes
<code>my_recent_income</code></li>
<li><code>SAMPLE2.!test1</code> becomes <code>sample2_test1</code></li>
<li><code>ThisIsTheName</code> becomes
<code>this_is_the_name</code></li>
<li><code>2015</code> becomes <code>x2015</code></li>
</ul>
<p>If we wanted to then use these columns (which we probably would,
since we created them), we could clean the names to get them into more
coder-friendly lower_snake_case with
<code>janitor::clean_names()</code>.</p>
<p>Let’s first install and load the <code>janitor</code> package:</p>
<pre class="r"><code>library(janitor) #install.packages(&quot;janitor&quot;)</code></pre>
<p>Then let’s load the data and clean the column names:</p>
<pre class="r"><code>msa &lt;- read_tsv(&quot;https://raw.githubusercontent.com/nt246/NTRES-6100-data-science/main/datasets/janitor_mymsa_subset.txt&quot;)</code></pre>
<pre><code>## Rows: 19 Columns: 13
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;\t&quot;
## chr (5): Hang-Method, HGP, Sex F/M, Est % BI, FeedType
## dbl (8): Plant ID, Body#, LeftSideScanTime, RightSideScanTime, LeftHscw, P8F...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>colnames(msa)</code></pre>
<pre><code>##  [1] &quot;Plant ID&quot;          &quot;Body#&quot;             &quot;LeftSideScanTime&quot; 
##  [4] &quot;RightSideScanTime&quot; &quot;Hang-Method&quot;       &quot;HGP&quot;              
##  [7] &quot;Sex F/M&quot;           &quot;LeftHscw&quot;          &quot;P8Fat&quot;            
## [10] &quot;Est % BI&quot;          &quot;FeedType&quot;          &quot;NoDaysOnFeed&quot;     
## [13] &quot;MSA/Index&quot;</code></pre>
<p>Let’s compare the column names before and after cleaning</p>
<pre class="r"><code>msa_clean &lt;- clean_names(msa)

cbind(colnames(msa), colnames(msa_clean))</code></pre>
<pre><code>##       [,1]                [,2]                  
##  [1,] &quot;Plant ID&quot;          &quot;plant_id&quot;            
##  [2,] &quot;Body#&quot;             &quot;body_number&quot;         
##  [3,] &quot;LeftSideScanTime&quot;  &quot;left_side_scan_time&quot; 
##  [4,] &quot;RightSideScanTime&quot; &quot;right_side_scan_time&quot;
##  [5,] &quot;Hang-Method&quot;       &quot;hang_method&quot;         
##  [6,] &quot;HGP&quot;               &quot;hgp&quot;                 
##  [7,] &quot;Sex F/M&quot;           &quot;sex_f_m&quot;             
##  [8,] &quot;LeftHscw&quot;          &quot;left_hscw&quot;           
##  [9,] &quot;P8Fat&quot;             &quot;p8fat&quot;               
## [10,] &quot;Est % BI&quot;          &quot;est_percent_bi&quot;      
## [11,] &quot;FeedType&quot;          &quot;feed_type&quot;           
## [12,] &quot;NoDaysOnFeed&quot;      &quot;no_days_on_feed&quot;     
## [13,] &quot;MSA/Index&quot;         &quot;msa_index&quot;</code></pre>
<p><br> <br></p>
<p>There are many other case options in <code>clean_names()</code>,
like:</p>
<ul>
<li>“snake” produces snake_case (the default)</li>
<li>“lower_camel” or “small_camel” produces lowerCamel</li>
<li>“upper_camel” or “big_camel” produces UpperCamel</li>
<li>“screaming_snake” or “all_caps” produces ALL_CAPS</li>
<li>“lower_upper” produces lowerUPPER</li>
<li>“upper_lower” produces UPPERlower</li>
</ul>
<p><img src="assets/case.jpg" /></p>
<p>Art by Allison Horst. Check out more <a
href="https://github.com/allisonhorst/stats-illustrations">here</a></p>
<p><br> <br></p>
<div id="parsing-different-data-types" class="section level3">
<h3>Parsing different data types</h3>
<p>As we saw above, when we run <code>read_csv()</code>, it prints out a
column specification that gives the name and type of each column.</p>
<p><br></p>
<blockquote>
<p>The following section is borrowed from <a
href="https://r4ds.had.co.nz/data-import.html">R4DS Chapter 11.4</a></p>
</blockquote>
<p><code>readr</code> uses a heuristic to figure out the column types.
For each column, it pulls the values of 1000^2 rows spaced evenly from
the first row to the last, ignoring missing values and uses some
(moderately conservative) heuristics to figure out the type of each
column.</p>
<p>The heuristic tries each of the following types, stopping when it
finds a match:</p>
<ul>
<li>logical: contains only “F”, “T”, “FALSE”, or “TRUE”.</li>
<li>integer: contains only numeric characters (and -).</li>
<li>double: contains only valid doubles (including numbers like
4.5e-5).</li>
<li>number: contains valid doubles with the grouping mark inside.</li>
<li>time: matches the default time_format.</li>
<li>date: matches the default date_format.</li>
<li>date-time: any ISO8601 date.</li>
</ul>
<p>If none of these rules apply, then the column will stay as a vector
of strings.</p>
<p>We’ll work through some examples on this, using the
<code>students.csv</code> examples from r4ds (2e) <a
href="https://r4ds.hadley.nz/data-import#reading-data-from-a-file">here</a></p>
<p><br> <br></p>
</div>
</div>
<div id="data-export" class="section level2">
<h2>Data export</h2>
<p><code>readr</code> also comes with two useful functions for writing
data back to disk: <code>write_csv()</code> and
<code>write_tsv()</code>. Both functions increase the chances of the
output file being read back in correctly and also let’s you save
dataframes with less typing than you often would need to e.g. avoid
rownames or quotes with the base-R function
<code>write.table()</code></p>
<p>Let’s look at an example. Say we wanted to save a summary we had
generated a few week ago of the coronavirus data:</p>
<pre class="r"><code>coronavirus &lt;- read_csv(&#39;https://raw.githubusercontent.com/RamiKrispin/coronavirus/master/csv/coronavirus.csv&#39;)</code></pre>
<pre><code>## Rows: 919308 Columns: 15
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (8): province, country, type, iso2, iso3, combined_key, continent_name,...
## dbl  (6): lat, long, cases, uid, code3, population
## date (1): date
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>coronavirus |&gt;  
  filter(type == &quot;confirmed&quot;) |&gt; 
  group_by(date) |&gt; 
  summarize(total_cases = sum(cases)) |&gt; 
  write_csv(file = &quot;../datasets/daily_casecount.csv&quot;)</code></pre>
<p><br></p>
<p>We also briefly talked about how to save plots a few classes ago. To
recap here:</p>
<div class="float">
<img
src="https://github.com/jennybc/ggplot2-tutorial/blob/master/ggplot2-tutorial-slides/ggplot2-tutorial-slides.050.png?raw=true"
alt="Slide from Jenny Bryan’s ggplot tutorial https://github.com/jennybc/ggplot2-tutorial" />
<div class="figcaption">Slide from Jenny Bryan’s ggplot tutorial <a
href="https://github.com/jennybc/ggplot2-tutorial"
class="uri">https://github.com/jennybc/ggplot2-tutorial</a></div>
</div>
<p><br></p>
<p>Use <code>ggsave()</code></p>
<pre class="r"><code>coronavirus |&gt;  
  filter(type == &quot;confirmed&quot;) |&gt; 
  group_by(date) |&gt; 
  summarize(total_cases = sum(cases)) |&gt; 
  ggplot(mapping = aes(x = date, y = total_cases)) +
  geom_line()</code></pre>
<p><img src="lesson13-files/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code>ggsave(filename = &quot;assets/daily_casecounts_plot.png&quot;)</code></pre>
<p><code>ggsave()</code> has really nice defaults, so you don’t
<em>have</em> to specify lots of different parameters. But you can! See
common examples <a
href="https://github.com/jennybc/ggplot2-tutorial/blob/master/ggplot2-tutorial-slides/ggplot2-tutorial-slides.055.png">here</a></p>
<p><br> <br></p>
</div>
<div id="creating-small-tibbles-on-the-fly" class="section level2">
<h2>Creating small tibbles on the fly</h2>
<p>Sometimes it can be useful to create small toy tibbles or tables for
displaying in an RMarkdown without having to read in a file.</p>
<p>To see how to do this, we’ll review <a
href="https://r4ds.had.co.nz/tibbles.html#creating-tibbles">R4DS Chapter
10.2</a> and <a
href="https://r4ds.had.co.nz/data-import.html#getting-started">11.2</a></p>
<p><br></p>
<div id="exercise" class="section level3">
<h3>Exercise:</h3>
<p>Reproduce the two tibbles below, first with the <code>tibble()</code>
and then with the <code>tribble()</code> functions.</p>
<p><br></p>
<table class=" lightable-paper lightable-hover" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
fruit
</th>
<th style="text-align:right;">
weight
</th>
<th style="text-align:right;">
price
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
apple
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
pear
</td>
<td style="text-align:right;">
3.4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
orange
</td>
<td style="text-align:right;">
5.2
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
<p><br></p>
<table class=" lightable-paper lightable-hover" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
Types
</th>
<th style="text-align:right;">
A
</th>
<th style="text-align:right;">
B
</th>
<th style="text-align:right;">
C
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
x
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
y
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
z
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7
</td>
</tr>
</tbody>
</table>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
